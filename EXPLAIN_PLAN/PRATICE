CREATE OR REPLACE VIEW QUERY_1 AS
SELECT barrio, count(barrio) NUMERO_COLEGIOS from colegios
inner join comunas ON colegios.comuna_id = comunas.id
where comunas.nombre = 'BUENOS AIRES'
group by barrio
order by NUMERO_COLEGIOS desc, barrio;

--querys 2
CREATE OR REPLACE VIEW QUERY_2 AS
SELECT distinct barrio,
count(*) OVER (partition by barrio) as NUMERO_COLEGIOS 
from colegios
inner join comunas ON colegios.comuna_id = comunas.id
where comunas.nombre = 'BUENOS AIRES'
order by NUMERO_COLEGIOS desc, barrio;


EXPLAIN PLAN SET STATEMENT_ID = 'QUERY_1' FOR SELECT * FROM QUERY_1;


EXPLAIN PLAN SET STATEMENT_ID = 'QUERY_2' FOR SELECT * FROM QUERY_2;



SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
SELECT PLAN_TABLE_OUTPUT FROM TABLE('QUERY_1');


EXPLAIN PLAN FOR
SELECT DISTINCT COLEGIOS.ID,
COLEGIOS.NOMBRE_SEDE,
COLEGIOS.COMUNA_ID,
COMUNAS.NOMBRE AS NOMBRE_COMUNA,
(CONTADOR_PREJARDIN_JARDIN + CONTADOR_TRANSICION + CONTADOR_PRIMARIA + CONTADOR_SECUNDARIA
  + CONTADOR_MEDIA + CONTADOR_ADULTOS ) AS TOTAL_GENERAL,
SUM (CONTADOR_PREJARDIN_JARDIN + CONTADOR_TRANSICION + CONTADOR_PRIMARIA + CONTADOR_SECUNDARIA
  + CONTADOR_MEDIA + CONTADOR_ADULTOS)  OVER (PARTITION BY COLEGIOS.COMUNA_ID) TOTAL_POR_COMUNA
  FROM COLEGIOS
INNER JOIN COMUNAS ON COLEGIOS.COMUNA_ID = COMUNAS.ID ORDER BY NOMBRE_COMUNA, NOMBRE_SEDE;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);

EXPLAIN PLAN FOR
SELECT COLEGIOS.ID,
COLEGIOS.NOMBRE_SEDE,
COLEGIOS.COMUNA_ID,
COMUNAS.NOMBRE AS NOMBRE_COMUNA,
(CONTADOR_PREJARDIN_JARDIN + CONTADOR_TRANSICION + CONTADOR_PRIMARIA + CONTADOR_SECUNDARIA
  + CONTADOR_MEDIA + CONTADOR_ADULTOS ) AS TOTAL_GENERAL,
SUM (CONTADOR_PREJARDIN_JARDIN + CONTADOR_TRANSICION + CONTADOR_PRIMARIA + CONTADOR_SECUNDARIA
  + CONTADOR_MEDIA + CONTADOR_ADULTOS)  OVER (PARTITION BY COLEGIOS.COMUNA_ID) TOTAL_POR_COMUNA
  FROM COLEGIOS
INNER JOIN COMUNAS ON COLEGIOS.COMUNA_ID = COMUNAS.ID ORDER BY NOMBRE_COMUNA, NOMBRE_SEDE;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
